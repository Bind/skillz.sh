---
import Layout from '../../layouts/Layout.astro';
import type { RegistrySkill } from '../../types/registry';
import registryData from '../../data/registry.json';

export async function getStaticPaths() {
  const data = registryData as { skills: RegistrySkill[] };
  return data.skills.map((skill) => ({
    params: { name: skill.name },
    props: { skill },
  }));
}

const { skill } = Astro.props;

const installCmd = `bunx skz add ${skill.name}`;
---

<Layout title={skill.name} activePage="skills">
  <main class="flex-1 py-8 px-8">
    <div class="max-w-3xl mx-auto">
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-3">
        <span class="text-xs px-2.5 py-0.5 rounded-md bg-zinc-100 text-zinc-600 border border-zinc-200">v{skill.version}</span>
        {skill.domain && <span class="text-xs px-2.5 py-0.5 rounded-md bg-zinc-100 text-zinc-600 border border-zinc-200 capitalize">{skill.domain}</span>}
      </div>
      <h1 class="text-4xl font-bold mb-3 tracking-tight text-zinc-900">{skill.name}</h1>
      <p class="text-lg text-zinc-600 leading-relaxed">{skill.description}</p>
    </div>

    <div class="mb-8 p-1 rounded-xl bg-gradient-to-r from-zinc-200/50 to-zinc-200/20">
      <div class="flex items-center justify-between gap-4 p-4 rounded-lg bg-zinc-50">
        <code class="text-sm text-zinc-700 font-mono">{installCmd}</code>
        <button
          onclick={`navigator.clipboard.writeText('${installCmd}')`}
          class="text-xs px-3 py-1.5 rounded-md bg-zinc-200 hover:bg-zinc-300 text-zinc-600 hover:text-zinc-900 transition-colors"
        >
          Copy
        </button>
      </div>
    </div>

    {skill.setup?.instructions && (
      <div class="mt-6 p-4 rounded-xl border border-amber-200 bg-amber-50">
        <h3 class="text-sm font-medium text-amber-700 mb-2">Setup Required</h3>
        <p class="text-sm text-zinc-600">{skill.setup.instructions}</p>
      </div>
    )}

    {skill.setup?.env && skill.setup.env.length > 0 && (
      <div class="mt-4 text-sm">
        <span class="text-zinc-600">Required env:</span>
        <span class="text-zinc-800 ml-2">{skill.setup.env.map((e) => `\`${e}\``).join(', ')}</span>
      </div>
    )}

    {skill.dependencies && Object.keys(skill.dependencies).length > 0 && (
      <div class="mt-6 p-4 rounded-xl border border-zinc-200 bg-zinc-50">
        <h3 class="text-sm font-medium text-zinc-700 mb-2">Dependencies</h3>
        <ul class="text-sm text-zinc-600 space-y-1">
          {Object.entries(skill.dependencies).map(([name, version]) => (
            <li><code>{name}</code> <span class="text-zinc-500">{version}</span></li>
          ))}
        </ul>
      </div>
    )}
    </div>
  </main>
</Layout>
