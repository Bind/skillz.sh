---
import Layout from '../../layouts/Layout.astro';
import PageContainer from '../../components/PageContainer.astro';
import Badge from '../../components/Badge.astro';
import Card from '../../components/Card.astro';
import { CodeBlock } from '../../components/CodeBlock';
import type { RegistrySkill } from '../../types/registry';
import registryData from '../../data/registry.json';

export async function getStaticPaths() {
  const data = registryData as { skills: RegistrySkill[] };
  return data.skills.map((skill) => ({
    params: { name: skill.name },
    props: { skill },
  }));
}

const { skill } = Astro.props;

const installCmd = `bunx skz add ${skill.name}`;
---

<Layout title={skill.name} activePage="skills">
  <PageContainer>
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-3">
        <Badge>v{skill.version}</Badge>
        {skill.domain && <Badge class="capitalize">{skill.domain}</Badge>}
      </div>
      <h1 class="text-4xl font-bold mb-3 tracking-tight text-gray-900">{skill.name}</h1>
      <p class="text-lg text-gray-600 leading-relaxed">{skill.description}</p>
    </div>

    <div class="mb-8">
      <CodeBlock code={installCmd} client:load />
    </div>

    {skill.setup?.instructions && (
      <Card variant="muted" class="mt-6">
        <h3 class="text-sm font-medium text-gray-700 mb-2">Setup Required</h3>
        <p class="text-sm text-gray-600">{skill.setup.instructions}</p>
      </Card>
    )}

    {skill.setup?.env && skill.setup.env.length > 0 && (
      <div class="mt-4 text-sm">
        <span class="text-gray-600">Required env:</span>
        <span class="text-gray-800 ml-2">{skill.setup.env.map((e) => `\`${e}\``).join(', ')}</span>
      </div>
    )}

    {skill.dependencies && Object.keys(skill.dependencies).length > 0 && (
      <Card variant="muted" class="mt-6">
        <h3 class="text-sm font-medium text-gray-700 mb-2">Dependencies</h3>
        <ul class="text-sm text-gray-600 space-y-1">
          {Object.entries(skill.dependencies).map(([name, version]) => (
            <li><code>{name}</code> <span class="text-gray-500">{version}</span></li>
          ))}
        </ul>
      </Card>
    )}
  </PageContainer>
</Layout>
