---
import Layout from "../../layouts/Layout.astro";
import registryData from "../../data/registry.json";

const { skills } = registryData;

// Group skills by domain
const byDomain = new Map<string, typeof skills>();
for (const skill of skills) {
  const domain = skill.domain ?? "other";
  const list = byDomain.get(domain) ?? [];
  list.push(skill);
  byDomain.set(domain, list);
}

const domains = [...byDomain.keys()].sort((a, b) => {
  if (a === "other") return 1;
  if (b === "other") return -1;
  return a.localeCompare(b);
});
---

<Layout title="Skills" activePage="skills">
  <div class="flex">
    <aside class="w-48 flex-shrink-0 py-6 px-6">
      <nav class="space-y-1">
        {domains.map((domain) => (
          <a
            href={`#domain-${domain}`}
            class="flex items-center px-3 py-2 text-sm rounded-md text-zinc-600 hover:text-zinc-900 hover:bg-zinc-100 transition-colors capitalize"
          >
            {domain}
          </a>
        ))}
      </nav>
    </aside>

    <main class="flex-1 py-8 px-8">
      <div class="max-w-3xl mx-auto">
        <div class="mb-8">
          <code class="text-sm bg-zinc-100 px-4 py-2 rounded-lg font-mono text-zinc-800">
            bunx skz add &lt;skill-name&gt;
          </code>
        </div>

        {domains.map((domain) => {
          const domainSkills = byDomain.get(domain)!;

          return (
            <section id={`domain-${domain}`} class="mb-10">
              <div class="flex items-center gap-3 mb-3">
                <h2 class="text-lg font-semibold capitalize text-zinc-900">
                  {domain}
                </h2>
                <span class="text-sm text-zinc-500">
                  {domainSkills.length} skill{domainSkills.length === 1 ? "" : "s"}
                </span>
              </div>

              <div class="grid gap-1">
                {domainSkills.map((skill) => (
                  <a
                    href={`/skills/${skill.name}`}
                    class="group block py-2 hover:bg-zinc-50 -mx-3 px-3 rounded-md transition-colors"
                  >
                    <div class="flex items-start justify-between gap-4">
                      <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2">
                          <h3 class="font-medium text-zinc-900 group-hover:text-zinc-700">{skill.name}</h3>
                          <span class="text-xs text-zinc-400">
                            v{skill.version}
                          </span>
                        </div>
                        <p class="text-sm text-zinc-500 mt-0.5 line-clamp-2">
                          {skill.description}
                        </p>
                      </div>
                      <span class="inline-flex flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity">
                        <svg
                          class="w-4 h-4 text-zinc-400"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 5l7 7-7 7"
                          />
                        </svg>
                      </span>
                    </div>
                  </a>
                ))}
              </div>
            </section>
          );
        })}
      </div>
    </main>
  </div>
</Layout>
