---
import Layout from "../../layouts/Layout.astro";
import InlineCode from "../../components/InlineCode.astro";
import RegistryListItem from "../../components/RegistryListItem.astro";
import registryData from "../../data/registry.json";

const { skills } = registryData;

// Group skills by domain
const byDomain = new Map<string, typeof skills>();
for (const skill of skills) {
  const domain = skill.domain ?? "other";
  const list = byDomain.get(domain) ?? [];
  list.push(skill);
  byDomain.set(domain, list);
}

const domains = [...byDomain.keys()].sort((a, b) => {
  if (a === "other") return 1;
  if (b === "other") return -1;
  return a.localeCompare(b);
});
---

<Layout title="Skills" activePage="skills">
  <div class="flex">
    <aside class="w-48 flex-shrink-0 py-6 px-6">
      <nav class="space-y-1">
        {domains.map((domain) => (
          <a
            href={`#domain-${domain}`}
            class="flex items-center px-3 py-2 text-sm rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors capitalize"
          >
            {domain}
          </a>
        ))}
      </nav>
    </aside>

    <main class="flex-1 py-8 px-8">
      <div class="max-w-3xl mx-auto">
        <div class="mb-8">
          <InlineCode class="px-4 py-2 rounded-lg">
            bunx @bind/skillz add &lt;skill-name&gt;
          </InlineCode>
        </div>

        {domains.map((domain) => {
          const domainSkills = byDomain.get(domain)!;
          const hasDomainPage = domain !== "other";

          return (
            <section id={`domain-${domain}`} class="mb-10">
              <div class="flex items-center gap-3 mb-3">
                {hasDomainPage ? (
                  <a 
                    href={`/skills/domain/${domain}`}
                    class="text-lg font-semibold capitalize text-gray-900 hover:text-gray-600 transition-colors"
                  >
                    {domain}
                  </a>
                ) : (
                  <h2 class="text-lg font-semibold capitalize text-gray-900">
                    {domain}
                  </h2>
                )}
                <span class="text-sm text-gray-500">
                  {domainSkills.length} skill{domainSkills.length === 1 ? "" : "s"}
                </span>
                {hasDomainPage && (
                  <a 
                    href={`/skills/domain/${domain}`}
                    class="text-xs text-gray-400 hover:text-gray-600 transition-colors"
                  >
                    View docs â†’
                  </a>
                )}
              </div>

              <div class="grid gap-1">
                {domainSkills.map((skill) => (
                  <RegistryListItem
                    href={`/skills/${skill.name}`}
                    name={skill.name}
                    version={skill.version}
                    description={skill.description}
                  />
                ))}
              </div>
            </section>
          );
        })}
      </div>
    </main>
  </div>
</Layout>
